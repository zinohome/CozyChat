# CozyChat 文档同步机制说明

> **文档位置**: `docs/20-文档同步机制说明.md`  
> **创建日期**: 2025-01-27  
> **最后更新**: 2025-01-27

## 📋 概述

为了确保项目文档中数据的一致性，我们建立了统一的文档同步机制。所有文档中的完成度数据都来自统一的数据源文件。

## 🎯 设计目标

1. **单一数据源**: 所有完成度数据来自 `docs/PROJECT_STATUS.json`
2. **自动同步**: 使用脚本自动同步数据到各个文档
3. **一致性保证**: 确保所有文档中的数据保持一致
4. **易于维护**: 只需更新一个文件，所有文档自动更新

## 📁 文件结构

```
docs/
├── PROJECT_STATUS.json          # 统一数据源（唯一真实来源）
├── PROGRESS.md                  # 开发进度报告（自动同步）
├── 09-功能模块完成度报告.md     # 功能模块报告（自动同步）
├── 10-未完成功能清单.md         # 未完成功能清单（自动同步）
└── 20-文档同步机制说明.md       # 本文档

scripts/
└── sync_docs.py                 # 文档同步脚本
```

## 🔧 使用方法

### 1. 更新数据源

编辑 `docs/PROJECT_STATUS.json`，更新完成度数据：

```json
{
  "overall_progress": {
    "percentage": 80
  },
  "backend": {
    "development": {
      "percentage": 100
    },
    "testing": {
      "percentage": 80
    }
  },
  "frontend": {
    "development": {
      "percentage": 60
    },
    "testing": {
      "percentage": 0
    }
  }
}
```

### 2. 预览更改（推荐）

在更新文档前，先预览将要进行的更改：

```bash
python scripts/sync_docs.py --dry-run
```

### 3. 同步文档

运行同步脚本，自动更新所有文档：

```bash
python scripts/sync_docs.py
```

### 4. 验证更改

检查更新后的文档，确保数据正确：

```bash
git diff docs/
```

## 📊 数据源结构

`PROJECT_STATUS.json` 包含以下主要数据：

### 总体进度
- `overall_progress.percentage`: 总体完成度百分比

### 后端数据
- `backend.development.percentage`: 后端开发完成度
- `backend.testing.percentage`: 后端测试覆盖率
- `backend.testing.test_count`: 测试用例数量
- `backend.modules`: 模块统计

### 前端数据
- `frontend.development.percentage`: 前端开发完成度
- `frontend.testing.percentage`: 前端测试覆盖率
- `frontend.completed_features`: 已完成功能列表
- `frontend.pending_features`: 待完成功能列表

### 阶段数据
- `phases`: 各阶段的完成度

### 问题追踪
- `issues`: 高优先级和中等优先级问题列表

## 🔄 同步流程

```
┌─────────────────────┐
│ PROJECT_STATUS.json │  ← 唯一数据源
└──────────┬──────────┘
           │
           │ sync_docs.py
           │
           ▼
    ┌──────────────┐
    │  读取数据源   │
    └──────┬───────┘
           │
           ▼
    ┌──────────────┐
    │  更新文档     │
    │  - PROGRESS.md│
    │  - 09-*.md    │
    │  - 10-*.md    │
    └──────────────┘
```

## 📝 更新文档的步骤

### 步骤1: 更新数据源

当项目进度发生变化时，首先更新 `PROJECT_STATUS.json`：

```json
{
  "frontend": {
    "development": {
      "percentage": 65  // 从60%更新到65%
    }
  }
}
```

### 步骤2: 运行同步脚本

```bash
# 预览更改
python scripts/sync_docs.py --dry-run

# 实际更新
python scripts/sync_docs.py
```

### 步骤3: 提交更改

```bash
git add docs/PROJECT_STATUS.json docs/*.md
git commit -m "docs: 更新项目完成度到65%"
```

## ⚠️ 注意事项

### 1. 不要直接编辑自动同步的文档

以下文档由脚本自动生成，不应直接编辑：
- `PROGRESS.md`（部分字段）
- `09-功能模块完成度报告.md`（完成度数据）
- `10-未完成功能清单.md`（完成度数据）

### 2. 只更新数据源文件

所有完成度数据应通过更新 `PROJECT_STATUS.json` 来修改。

### 3. 手动编辑的内容

以下内容可以手动编辑：
- 功能描述
- 技术细节
- 实施计划
- 问题分析

### 4. 定期同步

建议在以下情况运行同步脚本：
- 完成一个功能模块后
- 更新测试覆盖率后
- 每周定期同步一次

## 🛠️ 脚本功能

### sync_docs.py

**功能**:
- 从 `PROJECT_STATUS.json` 读取数据
- 更新各个文档中的完成度数据
- 保持文档格式不变

**选项**:
- `--dry-run`: 预览模式，不实际修改文件
- `--update-status`: 从代码统计更新状态文件（未来功能）

**示例**:
```bash
# 预览更改
python scripts/sync_docs.py --dry-run

# 实际更新
python scripts/sync_docs.py
```

## 📈 最佳实践

### 1. 更新频率

- **开发阶段**: 每完成一个功能模块更新一次
- **测试阶段**: 每次测试覆盖率变化后更新
- **定期**: 每周至少同步一次

### 2. 更新流程

1. ✅ 完成功能或测试
2. ✅ 更新 `PROJECT_STATUS.json`
3. ✅ 运行 `sync_docs.py --dry-run` 预览
4. ✅ 运行 `sync_docs.py` 同步
5. ✅ 检查更改并提交

### 3. 版本控制

- 数据源文件和文档一起提交
- 提交信息包含更新说明
- 定期备份数据源文件

## 🔍 故障排查

### 问题1: 脚本无法找到文件

**解决方案**:
```bash
# 确保在项目根目录运行
cd /path/to/CozyChat
python scripts/sync_docs.py
```

### 问题2: JSON格式错误

**解决方案**:
```bash
# 验证JSON格式
python -m json.tool docs/PROJECT_STATUS.json
```

### 问题3: 文档未更新

**解决方案**:
1. 检查 `PROJECT_STATUS.json` 是否正确
2. 检查脚本是否有错误输出
3. 使用 `--dry-run` 查看预览

## 📚 相关文档

- [项目检查报告](19-项目检查报告.md) - 问题识别和修复建议
- [开发进度报告](../PROGRESS.md) - 详细的开发进度
- [功能模块完成度报告](09-功能模块完成度报告.md) - 功能模块完成情况

## 🎯 未来改进

1. **自动化**: 集成到CI/CD流程
2. **统计脚本**: 从代码自动统计完成度
3. **验证机制**: 自动验证数据一致性
4. **报告生成**: 自动生成进度报告

---

**文档版本**: v1.0  
**最后更新**: 2025-01-27  
**维护者**: CozyChat Team

