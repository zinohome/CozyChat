# CozyChat 项目概述

## 1. 项目简介

CozyChat 是一个现代化的 AI 对话应用，采用 **Python 后端 + React 前端** 的架构，提供灵活的模块化设计和强大的扩展能力。

### 1.1 项目定位

- **目标用户**: 需要智能对话助手的个人和企业用户
- **核心价值**: 人格化AI交互、多模态支持、灵活扩展
- **应用场景**: Web应用、移动端、微信浏览器

### 1.2 核心特性

#### 🎯 人格化AI系统
- 支持多个AI人格，每个人格有独立的配置
- 人格可配置记忆策略、工具权限、语音特性
- 真正模拟"人"的概念，作为与用户交互的主体

#### 🧠 智能记忆管理
- 向量数据库支持（ChromaDB/Qdrant）
- 区分用户记忆和AI记忆
- 智能检索和缓存机制

#### 🛠️ 统一工具系统
- 内置工具（搜索、计算、时间等）
- MCP协议工具自动发现
- 工具权限按人格配置

#### 🎤 多模态语音支持
- STT：OpenAI / 腾讯ASR / 自定义
- TTS：OpenAI / 腾讯TTS / 自定义
- RealTime：OpenAI Realtime API / 自定义

#### 🤖 多模型支持
- OpenAI API
- Ollama (本地模型)
- LM Studio (本地模型)
- 可扩展至其他模型服务商

## 2. 技术栈选型

### 2.1 后端技术栈

```yaml
核心框架:
  - FastAPI: 高性能异步Web框架
  - Pydantic: 数据验证和序列化
  - Uvicorn: ASGI服务器

数据库:
  - PostgreSQL: 主数据库（用户、会话、配置）
  - Redis: 缓存层
  - ChromaDB/Qdrant: 向量数据库（记忆）

AI框架:
  - OpenAI SDK: OpenAI模型调用
  - Ollama Python SDK: 本地模型支持
  - LangChain (可选): 工具链编排

工具协议:
  - MCP SDK: Model Context Protocol

其他:
  - SQLAlchemy: ORM框架
  - Alembic: 数据库迁移
  - Celery (可选): 异步任务队列
  - WebSocket: 实时通信
```

### 2.2 前端技术栈

```yaml
核心框架:
  - React 18+: UI框架
  - TypeScript: 类型安全
  - Vite: 构建工具

UI组件:
  - llm-ui / chatscope: AI聊天组件
  - Ant Design / shadcn/ui: 通用UI组件
  - TailwindCSS: 样式框架

状态管理:
  - Zustand / Jotai: 轻量级状态管理
  - TanStack Query: 服务端状态管理

实时通信:
  - WebSocket API: 原生WebSocket
  - EventSource: SSE支持

移动端适配:
  - Responsive Design: 响应式布局
  - PWA: 渐进式Web应用
  - 微信浏览器兼容性处理
```

### 2.3 部署架构

```yaml
开发环境:
  - Docker Compose: 本地开发环境
  - Hot Reload: 代码热重载

生产环境:
  - Docker: 容器化部署
  - Nginx: 反向代理和静态文件服务
  - PostgreSQL: 主数据库
  - Redis: 缓存和会话存储
  - ChromaDB/Qdrant: 向量数据库服务
```

## 3. 架构设计原则

### 3.1 模块化与可插拔

```
所有核心组件采用插件式架构:
- AI引擎: 不同模型提供者作为插件
- 记忆系统: 不同向量数据库作为插件
- 语音引擎: STT/TTS/RealTime都支持多种实现
- 工具系统: 内置工具和MCP工具统一接口
```

### 3.2 配置驱动

```
使用YAML配置文件管理:
- 系统配置: config/system.yaml
- 人格配置: config/personalities/*.yaml
- 工具配置: config/tools/*.yaml
- 模型配置: config/models/*.yaml
```

### 3.3 前后端分离

```
清晰的职责划分:
- 后端: 业务逻辑、数据存储、AI调用
- 前端: 用户界面、交互逻辑、状态管理
- 通信: RESTful API + WebSocket
```

### 3.4 安全性设计

```
多层安全机制:
- JWT认证: 用户身份验证
- API Key: 服务间认证
- RBAC: 基于角色的访问控制
- 数据加密: 敏感数据加密存储
- Rate Limiting: API限流保护
```

## 4. 项目结构

### 4.1 整体目录结构

```
CozyChat/
├── backend/                 # 后端服务
│   ├── app/                # 应用代码
│   ├── config/             # 配置文件
│   ├── tests/              # 测试代码
│   ├── alembic/            # 数据库迁移
│   ├── requirements.txt    # Python依赖
│   └── Dockerfile          # 后端容器
├── frontend/               # 前端应用
│   ├── src/               # 源代码
│   ├── public/            # 静态资源
│   ├── package.json       # Node依赖
│   └── Dockerfile         # 前端容器
├── docs/                   # 项目文档
│   ├── 01-项目概述.md
│   ├── 02-后端架构设计.md
│   ├── 03-前端架构设计.md
│   ├── 04-API接口设计.md
│   ├── 05-数据库设计.md
│   └── 06-部署运维.md
├── docker-compose.yml      # 开发环境编排
└── README.md              # 项目说明
```

## 5. 开发路线图

### Phase 1: 基础架构搭建（Week 1-2）
- [x] 项目结构初始化
- [ ] 后端基础框架（FastAPI + SQLAlchemy）
- [ ] 前端基础框架（React + Vite）
- [ ] 数据库设计和迁移
- [ ] 基础认证系统

### Phase 2: 核心功能开发（Week 3-6）
- [ ] AI引擎模块（OpenAI/Ollama/LM Studio）
- [ ] 记忆管理系统
- [ ] 工具系统（内置工具 + MCP）
- [ ] 人格系统
- [ ] 基础聊天界面

### Phase 3: 语音功能（Week 7-8）
- [ ] STT引擎集成
- [ ] TTS引擎集成
- [ ] RealTime语音对话
- [ ] 前端音频处理

### Phase 4: 用户系统（Week 9-10）
- [ ] 用户注册登录
- [ ] 用户权限管理
- [ ] 用户画像系统
- [ ] 用户偏好设置

### Phase 5: 优化与测试（Week 11-12）
- [ ] 性能优化
- [ ] 移动端适配
- [ ] 微信浏览器兼容
- [ ] 完整测试
- [ ] 部署文档

## 6. 关键技术决策

### 6.1 为什么选择 FastAPI？
- ✅ 原生异步支持，性能优异
- ✅ 自动生成OpenAPI文档
- ✅ Pydantic数据验证
- ✅ WebSocket支持良好
- ✅ 活跃的社区生态

### 6.2 为什么选择 React？
- ✅ 组件化开发，可维护性强
- ✅ 丰富的AI聊天组件生态
- ✅ 移动端支持好（React Native可扩展）
- ✅ TypeScript支持完善
- ✅ 大量成熟的UI库

### 6.3 为什么选择 PostgreSQL？
- ✅ 关系型数据库，ACID保证
- ✅ JSON/JSONB支持，灵活存储
- ✅ 全文搜索支持
- ✅ 连接池管理成熟
- ✅ 丰富的扩展生态

### 6.4 为什么使用向量数据库？
- ✅ 语义搜索，记忆检索更准确
- ✅ 可扩展性强
- ✅ 支持多种距离度量
- ✅ ChromaDB/Qdrant成熟稳定

## 7. 与旧项目的对比

### 7.1 架构改进

| 方面 | 旧项目（yyAsistant + yychat） | 新项目（CozyChat） |
|------|------------------------------|-------------------|
| 前端框架 | Dash (Python) | React (JavaScript/TypeScript) |
| 后端框架 | Flask + Dash | FastAPI |
| 数据库 | SQLite + Peewee | PostgreSQL + SQLAlchemy |
| 配置管理 | Python类配置 | YAML配置文件 |
| 状态管理 | Dash Store + Clientside Callbacks | Zustand/Jotai + TanStack Query |
| AI引擎 | 仅OpenAI | OpenAI + Ollama + LM Studio |
| 语音引擎 | 仅OpenAI | 多引擎支持 |

### 7.2 功能增强

```
✅ 新增功能:
- 多模型支持（Ollama, LM Studio）
- 人格系统增强（配置更丰富）
- 记忆系统优化（区分用户/AI记忆）
- 用户画像系统
- PWA支持
- 更好的移动端体验

✅ 保留功能:
- 文本聊天（流式/非流式）
- 语音对话
- 工具调用
- MCP协议
- 会话管理

✅ 简化部分:
- 减少配置复杂度
- 统一状态管理
- 清晰的职责划分
```

## 8. 下一步

请查看以下详细设计文档：

1. [02-后端架构设计.md](./02-后端架构设计.md) - 后端模块详细设计
2. [03-前端架构设计.md](./03-前端架构设计.md) - 前端组件详细设计
3. [04-API接口设计.md](./04-API接口设计.md) - API接口规范
4. [05-数据库设计.md](./05-数据库设计.md) - 数据库表结构设计
5. [06-部署运维.md](./06-部署运维.md) - 部署和运维指南

---

**文档版本**: v1.0  
**最后更新**: 2025-11-06  
**维护者**: CozyChat Team

