# 06-å¼€å‘è§„èŒƒ

## ç›®å½•

- [1. é¡¹ç›®è§„èŒƒ](#1-é¡¹ç›®è§„èŒƒ)
  - [1.1 ç¯å¢ƒå˜é‡ç®¡ç†](#11-ç¯å¢ƒå˜é‡ç®¡ç†)
  - [1.2 æ•°æ®åº“è¿ç§»](#12-æ•°æ®åº“è¿ç§»)
  - [1.3 ä»£ç è´¨é‡](#13-ä»£ç è´¨é‡)
  - [1.4 æµ‹è¯•é©±åŠ¨](#14-æµ‹è¯•é©±åŠ¨)
  - [1.5 æ–‡æ¡£åŒæ­¥](#15-æ–‡æ¡£åŒæ­¥)
- [2. Pythonå¼€å‘è§„èŒƒ](#2-pythonå¼€å‘è§„èŒƒ)
  - [2.1 ä»£ç é£æ ¼](#21-ä»£ç é£æ ¼)
  - [2.2 é¡¹ç›®ç»“æ„](#22-é¡¹ç›®ç»“æ„)
  - [2.3 å‘½åè§„èŒƒ](#23-å‘½åè§„èŒƒ)
  - [2.4 ç±»å‹æ³¨è§£](#24-ç±»å‹æ³¨è§£)
  - [2.5 é”™è¯¯å¤„ç†](#25-é”™è¯¯å¤„ç†)
  - [2.6 å¼‚æ­¥ç¼–ç¨‹](#26-å¼‚æ­¥ç¼–ç¨‹)
  - [2.7 æ—¥å¿—è§„èŒƒ](#27-æ—¥å¿—è§„èŒƒ)
  - [2.8 ä¾èµ–ç®¡ç†](#28-ä¾èµ–ç®¡ç†)
- [3. Reactå¼€å‘è§„èŒƒ](#3-reactå¼€å‘è§„èŒƒ)
  - [3.1 ä»£ç é£æ ¼](#31-ä»£ç é£æ ¼)
  - [3.2 é¡¹ç›®ç»“æ„](#32-é¡¹ç›®ç»“æ„)
  - [3.3 ç»„ä»¶è§„èŒƒ](#33-ç»„ä»¶è§„èŒƒ)
  - [3.4 çŠ¶æ€ç®¡ç†](#34-çŠ¶æ€ç®¡ç†)
  - [3.5 APIè°ƒç”¨](#35-apiè°ƒç”¨)
  - [3.6 æ ·å¼è§„èŒƒ](#36-æ ·å¼è§„èŒƒ)
  - [3.7 æ€§èƒ½ä¼˜åŒ–](#37-æ€§èƒ½ä¼˜åŒ–)

---

## 1. é¡¹ç›®è§„èŒƒ

### 1.1 ç¯å¢ƒå˜é‡ç®¡ç†

**åŸåˆ™**: æ‰€æœ‰æ•æ„Ÿä¿¡æ¯ï¼ˆAPI Keyã€æ•°æ®åº“å¯†ç ç­‰ï¼‰å¿…é¡»é€šè¿‡ç¯å¢ƒå˜é‡ç®¡ç†ï¼Œä¸è¦æäº¤åˆ°Gitã€‚

#### 1.1.1 åç«¯ç¯å¢ƒå˜é‡

åˆ›å»º `.env.example` ä½œä¸ºæ¨¡æ¿ï¼š

```bash
# .env.example - æäº¤åˆ°Git
# å¼€å‘è€…å¤åˆ¶ä¸º .env å¹¶å¡«å…¥çœŸå®å€¼

# ===== OpenAIé…ç½® =====
OPENAI_API_KEY=your_openai_api_key_here
OPENAI_BASE_URL=https://api.openai.com/v1

# ===== æ•°æ®åº“é…ç½® =====
DATABASE_URL=postgresql://user:password@localhost:5432/cozychat
POSTGRES_USER=cozychat_user
POSTGRES_PASSWORD=your_password_here
POSTGRES_DB=cozychat

# ===== Redisé…ç½® =====
REDIS_URL=redis://localhost:6379/0
REDIS_PASSWORD=

# ===== åº”ç”¨é…ç½® =====
APP_SECRET_KEY=your_secret_key_here
JWT_SECRET_KEY=your_jwt_secret_here
APP_ENV=development

# ===== å‘é‡æ•°æ®åº“ =====
CHROMA_PERSIST_DIRECTORY=./data/chroma
QDRANT_URL=http://localhost:6333
QDRANT_API_KEY=

# ===== è…¾è®¯äº‘é…ç½® =====
TENCENT_SECRET_ID=
TENCENT_SECRET_KEY=
TENCENT_APP_ID=

# ===== æ—¥å¿—é…ç½® =====
LOG_LEVEL=INFO
LOG_FILE=logs/app.log
```

#### 1.1.2 å‰ç«¯ç¯å¢ƒå˜é‡

```bash
# frontend/.env.example

# APIåŸºç¡€URL
REACT_APP_API_BASE_URL=http://localhost:8000
REACT_APP_WS_URL=ws://localhost:8000

# åº”ç”¨é…ç½®
REACT_APP_ENV=development
REACT_APP_VERSION=0.1.0
```

#### 1.1.3 é…ç½®åŠ è½½

**Pythoné…ç½®åŠ è½½** (`backend/app/config/config.py`):

```python
from pydantic_settings import BaseSettings
from typing import Optional

class Settings(BaseSettings):
    """åº”ç”¨é…ç½®"""
    
    # OpenAI
    openai_api_key: str
    openai_base_url: str = "https://api.openai.com/v1"
    
    # æ•°æ®åº“
    database_url: str
    
    # Redis
    redis_url: str
    redis_password: Optional[str] = None
    
    # åº”ç”¨
    app_secret_key: str
    jwt_secret_key: str
    app_env: str = "development"
    
    # æ—¥å¿—
    log_level: str = "INFO"
    log_file: str = "logs/app.log"
    
    class Config:
        env_file = ".env"
        case_sensitive = False

# å…¨å±€é…ç½®å®ä¾‹
settings = Settings()
```

#### 1.1.4 Gitå¿½ç•¥é…ç½®

`.gitignore` å¿…é¡»åŒ…å«ï¼š

```gitignore
# ç¯å¢ƒå˜é‡
.env
.env.local
.env.*.local

# æ•°æ®åº“
*.db
*.sqlite
*.sqlite3

# æ—¥å¿—
logs/
*.log

# å‘é‡æ•°æ®åº“
data/chroma/
data/qdrant/

# Python
__pycache__/
*.pyc
.venv/
venv/

# React
frontend/node_modules/
frontend/build/
frontend/.env.local
```

---

### 1.2 æ•°æ®åº“è¿ç§»

**åŸåˆ™**: ä»ç¬¬ä¸€å¤©å°±ä½¿ç”¨Alembicç®¡ç†æ•°æ®åº“å˜æ›´ï¼Œç¡®ä¿å›¢é˜Ÿå¼€å‘å’Œç”Ÿäº§ç¯å¢ƒçš„æ•°æ®åº“ä¸€è‡´æ€§ã€‚

#### 1.2.1 Alembicåˆå§‹åŒ–

```bash
# åç«¯ç›®å½•
cd backend

# åˆå§‹åŒ–Alembic
alembic init alembic

# ç›®å½•ç»“æ„
# backend/
#   alembic/
#     versions/
#     env.py
#   alembic.ini
```

#### 1.2.2 é…ç½®Alembic

**`alembic.ini`**:

```ini
[alembic]
script_location = alembic
sqlalchemy.url = driver://user:pass@localhost/dbname  # å°†è¢«env.pyè¦†ç›–

[loggers]
keys = root,sqlalchemy,alembic

[handlers]
keys = console

[formatters]
keys = generic
```

**`alembic/env.py`**:

```python
from logging.config import fileConfig
from sqlalchemy import engine_from_config, pool
from alembic import context
from app.config.config import settings
from app.models.base import Base

# å¯¼å…¥æ‰€æœ‰æ¨¡å‹
from app.models.user import User, UserProfile
from app.models.session import Session
from app.models.memory import Memory

config = context.config

# ä»ç¯å¢ƒå˜é‡è·å–æ•°æ®åº“URL
config.set_main_option("sqlalchemy.url", settings.database_url)

fileConfig(config.config_file_name)

target_metadata = Base.metadata

def run_migrations_offline():
    """ç¦»çº¿æ¨¡å¼"""
    url = config.get_main_option("sqlalchemy.url")
    context.configure(
        url=url,
        target_metadata=target_metadata,
        literal_binds=True,
        dialect_opts={"paramstyle": "named"},
    )

    with context.begin_transaction():
        context.run_migrations()

def run_migrations_online():
    """åœ¨çº¿æ¨¡å¼"""
    connectable = engine_from_config(
        config.get_section(config.config_ini_section),
        prefix="sqlalchemy.",
        poolclass=pool.NullPool,
    )

    with connectable.connect() as connection:
        context.configure(
            connection=connection,
            target_metadata=target_metadata
        )

        with context.begin_transaction():
            context.run_migrations()

if context.is_offline_mode():
    run_migrations_offline()
else:
    run_migrations_online()
```

#### 1.2.3 åˆ›å»ºå’Œåº”ç”¨è¿ç§»

```bash
# 1. è‡ªåŠ¨ç”Ÿæˆè¿ç§»è„šæœ¬
alembic revision --autogenerate -m "Initial migration"

# 2. æŸ¥çœ‹å½“å‰ç‰ˆæœ¬
alembic current

# 3. åº”ç”¨è¿ç§»
alembic upgrade head

# 4. å›æ»šä¸€ä¸ªç‰ˆæœ¬
alembic downgrade -1

# 5. æŸ¥çœ‹è¿ç§»å†å²
alembic history
```

#### 1.2.4 è¿ç§»æœ€ä½³å®è·µ

1. **æ¯æ¬¡æ¨¡å‹å˜æ›´éƒ½åˆ›å»ºè¿ç§»**:

```bash
# ä¿®æ”¹æ¨¡å‹å
alembic revision --autogenerate -m "Add user preferences field"
```

2. **è¿ç§»è„šæœ¬éœ€è¦å®¡æŸ¥**:
   - è‡ªåŠ¨ç”Ÿæˆçš„è¿ç§»å¯èƒ½ä¸å®Œç¾
   - æ‰‹åŠ¨æ£€æŸ¥ `versions/*.py` æ–‡ä»¶
   - ç¡®ä¿ `upgrade()` å’Œ `downgrade()` éƒ½æ­£ç¡®

3. **æäº¤è¿ç§»è„šæœ¬åˆ°Git**:

```bash
git add alembic/versions/*.py
git commit -m "Add migration: user preferences"
```

4. **å›¢é˜Ÿåä½œæµç¨‹**:

```bash
# æ‹‰å–æœ€æ–°ä»£ç å
git pull
alembic upgrade head  # åº”ç”¨æ–°è¿ç§»
```

---

### 1.3 ä»£ç è´¨é‡

**åŸåˆ™**: é…ç½®pre-commit hooksï¼Œç¡®ä¿ä»£ç è´¨é‡ã€‚

#### 1.3.1 å®‰è£…pre-commit

```bash
pip install pre-commit
```

#### 1.3.2 é…ç½®æ–‡ä»¶

**`.pre-commit-config.yaml`**:

```yaml
repos:
  # Pythonä»£ç æ ¼å¼åŒ–
  - repo: https://github.com/psf/black
    rev: 23.12.1
    hooks:
      - id: black
        language_version: python3.11
        args: [--line-length=100]

  # Pythonå¯¼å…¥æ’åº
  - repo: https://github.com/PyCQA/isort
    rev: 5.13.2
    hooks:
      - id: isort
        args: [--profile=black]

  # Pythonä»£ç æ£€æŸ¥
  - repo: https://github.com/PyCQA/flake8
    rev: 7.0.0
    hooks:
      - id: flake8
        args: [--max-line-length=100, --extend-ignore=E203]

  # ç±»å‹æ£€æŸ¥
  - repo: https://github.com/pre-commit/mirrors-mypy
    rev: v1.8.0
    hooks:
      - id: mypy
        additional_dependencies: [types-all]
        args: [--ignore-missing-imports]

  # é€šç”¨æ£€æŸ¥
  - repo: https://github.com/pre-commit/pre-commit-hooks
    rev: v4.5.0
    hooks:
      - id: trailing-whitespace
      - id: end-of-file-fixer
      - id: check-yaml
      - id: check-added-large-files
        args: [--maxkb=1000]
      - id: check-json
      - id: check-merge-conflict
      - id: detect-private-key

  # JavaScript/TypeScript
  - repo: https://github.com/pre-commit/mirrors-eslint
    rev: v8.56.0
    hooks:
      - id: eslint
        files: \.(js|jsx|ts|tsx)$
        types: [file]
        additional_dependencies:
          - eslint
          - eslint-config-prettier
          - eslint-plugin-react
          - eslint-plugin-react-hooks
          - '@typescript-eslint/eslint-plugin'
          - '@typescript-eslint/parser'

  # Prettieræ ¼å¼åŒ–
  - repo: https://github.com/pre-commit/mirrors-prettier
    rev: v3.1.0
    hooks:
      - id: prettier
        files: \.(js|jsx|ts|tsx|json|css|scss|md)$
```

#### 1.3.3 å®‰è£…hooks

```bash
# å®‰è£…pre-commit hooks
pre-commit install

# æ‰‹åŠ¨è¿è¡Œæ‰€æœ‰æ–‡ä»¶
pre-commit run --all-files

# è·³è¿‡hooksæäº¤ï¼ˆç´§æ€¥æƒ…å†µï¼‰
git commit --no-verify -m "Emergency fix"
```

#### 1.3.4 Pythonä»£ç è´¨é‡å·¥å…·é…ç½®

**`pyproject.toml`**:

```toml
[tool.black]
line-length = 100
target-version = ['py311']
include = '\.pyi?$'
exclude = '''
/(
    \.git
  | \.venv
  | build
  | dist
)/
'''

[tool.isort]
profile = "black"
line_length = 100
multi_line_output = 3
include_trailing_comma = true

[tool.mypy]
python_version = "3.11"
warn_return_any = true
warn_unused_configs = true
disallow_untyped_defs = false
ignore_missing_imports = true

[tool.pytest.ini_options]
testpaths = ["tests"]
python_files = ["test_*.py"]
python_functions = ["test_*"]
addopts = "-v --cov=app --cov-report=html --cov-report=term"
```

---

### 1.4 æµ‹è¯•é©±åŠ¨

**åŸåˆ™**: å…³é”®æ¨¡å—ç¼–å†™æµ‹è¯•ç”¨ä¾‹ï¼Œç¡®ä¿ä»£ç å¯é æ€§ã€‚

#### 1.4.1 æµ‹è¯•æ¡†æ¶

**Python**: pytest + pytest-asyncio + pytest-cov

```bash
pip install pytest pytest-asyncio pytest-cov pytest-mock
```

**React**: Jest + React Testing Library

```bash
npm install --save-dev @testing-library/react @testing-library/jest-dom
```

#### 1.4.2 æµ‹è¯•ç›®å½•ç»“æ„

```
backend/
  tests/
    unit/
      test_ai_engine.py
      test_memory_manager.py
      test_tool_manager.py
    integration/
      test_api_chat.py
      test_api_user.py
    fixtures/
      conftest.py
    
frontend/
  src/
    components/
      ChatMessage/
        ChatMessage.tsx
        ChatMessage.test.tsx
    hooks/
      useChat.ts
      useChat.test.ts
```

#### 1.4.3 æµ‹è¯•ç¤ºä¾‹

**Pythonå•å…ƒæµ‹è¯•**:

```python
# tests/unit/test_ai_engine.py
import pytest
from app.engines.ai.openai_engine import OpenAIEngine

@pytest.fixture
def openai_engine():
    config = {
        "api_key": "test_key",
        "model": "gpt-4",
        "temperature": 0.7
    }
    return OpenAIEngine(config)

@pytest.mark.asyncio
async def test_chat_completion(openai_engine, mocker):
    """æµ‹è¯•èŠå¤©å®Œæˆ"""
    # Mock OpenAI API
    mock_response = {
        "choices": [{"message": {"content": "Hello!"}}]
    }
    mocker.patch.object(
        openai_engine.client.chat.completions,
        "create",
        return_value=mock_response
    )
    
    messages = [{"role": "user", "content": "Hi"}]
    response = await openai_engine.chat_completion(messages)
    
    assert response["content"] == "Hello!"
```

**Reactç»„ä»¶æµ‹è¯•**:

```typescript
// src/components/ChatMessage/ChatMessage.test.tsx
import { render, screen } from '@testing-library/react';
import ChatMessage from './ChatMessage';

describe('ChatMessage', () => {
  it('renders user message correctly', () => {
    render(
      <ChatMessage
        role="user"
        content="Hello, AI!"
        timestamp={new Date()}
      />
    );
    
    expect(screen.getByText('Hello, AI!')).toBeInTheDocument();
    expect(screen.getByTestId('user-message')).toBeInTheDocument();
  });
  
  it('renders assistant message with markdown', () => {
    render(
      <ChatMessage
        role="assistant"
        content="**Bold** text"
        timestamp={new Date()}
      />
    );
    
    expect(screen.getByText('Bold')).toHaveStyle('font-weight: bold');
  });
});
```

#### 1.4.4 æµ‹è¯•è¦†ç›–ç‡è¦æ±‚

- **æ ¸å¿ƒæ¨¡å—**: â‰¥ 80%
- **APIæ¥å£**: â‰¥ 70%
- **å·¥å…·å‡½æ•°**: â‰¥ 90%
- **UIç»„ä»¶**: â‰¥ 60%

```bash
# è¿è¡Œæµ‹è¯•å¹¶ç”Ÿæˆè¦†ç›–ç‡æŠ¥å‘Š
pytest --cov=app --cov-report=html
```

---

### 1.5 æ–‡æ¡£åŒæ­¥

**åŸåˆ™**: ä»£ç å˜æ›´æ—¶åŒæ­¥æ›´æ–°æ–‡æ¡£ã€‚

#### 1.5.1 æ–‡æ¡£ç±»å‹

1. **æ¶æ„æ–‡æ¡£** (`docs/`):
   - é‡å¤§æ¶æ„å˜æ›´æ—¶æ›´æ–°
   - æ–°å¢æ¨¡å—æ—¶è¡¥å……è¯´æ˜

2. **APIæ–‡æ¡£** (è‡ªåŠ¨ç”Ÿæˆ):
   - ä½¿ç”¨FastAPIè‡ªåŠ¨ç”ŸæˆSwaggeræ–‡æ¡£
   - è®¿é—® `http://localhost:8000/docs`

3. **ä»£ç æ³¨é‡Š**:
   - å‡½æ•°/ç±»å¿…é¡»æœ‰docstring
   - å¤æ‚é€»è¾‘æ·»åŠ è¡Œå†…æ³¨é‡Š

4. **README**:
   - æ–°åŠŸèƒ½æ·»åŠ ä½¿ç”¨è¯´æ˜
   - ç¯å¢ƒé…ç½®å˜æ›´æ—¶æ›´æ–°

#### 1.5.2 æ–‡æ¡£å®¡æŸ¥æ¸…å•

æ¯æ¬¡PRå¿…é¡»æ£€æŸ¥ï¼š

- [ ] æ–°å¢APIæ˜¯å¦æœ‰docstring
- [ ] é…ç½®å˜æ›´æ˜¯å¦æ›´æ–°äº†`.env.example`
- [ ] æ•°æ®åº“å˜æ›´æ˜¯å¦æœ‰è¿ç§»è„šæœ¬
- [ ] æ–°åŠŸèƒ½æ˜¯å¦æ›´æ–°äº†README
- [ ] é‡å¤§å˜æ›´æ˜¯å¦æ›´æ–°äº†æ¶æ„æ–‡æ¡£

---

## 2. Pythonå¼€å‘è§„èŒƒ

### 2.1 ä»£ç é£æ ¼

#### 2.1.1 åŸºæœ¬è§„èŒƒ

éµå¾ª **PEP 8**ï¼Œä½¿ç”¨ **Black** è‡ªåŠ¨æ ¼å¼åŒ–ï¼š

- **è¡Œé•¿åº¦**: 100å­—ç¬¦
- **ç¼©è¿›**: 4ä¸ªç©ºæ ¼
- **å¼•å·**: ä¼˜å…ˆä½¿ç”¨åŒå¼•å·
- **å¯¼å…¥**: æŒ‰æ ‡å‡†åº“ã€ç¬¬ä¸‰æ–¹åº“ã€æœ¬åœ°åº“åˆ†ç»„

#### 2.1.2 ç¤ºä¾‹

```python
# æ ‡å‡†åº“
import os
import sys
from typing import Dict, List, Optional

# ç¬¬ä¸‰æ–¹åº“
from fastapi import FastAPI, HTTPException
from sqlalchemy.orm import Session

# æœ¬åœ°åº“
from app.config.config import settings
from app.utils.logger import logger


class UserManager:
    """ç”¨æˆ·ç®¡ç†å™¨
    
    è´Ÿè´£ç”¨æˆ·çš„åˆ›å»ºã€è®¤è¯å’Œæƒé™ç®¡ç†ã€‚
    
    Attributes:
        db: æ•°æ®åº“ä¼šè¯
        auth_service: è®¤è¯æœåŠ¡å®ä¾‹
    """
    
    def __init__(self, db: Session):
        """åˆå§‹åŒ–ç”¨æˆ·ç®¡ç†å™¨
        
        Args:
            db: SQLAlchemyæ•°æ®åº“ä¼šè¯
        """
        self.db = db
        self.auth_service = AuthService()
    
    async def authenticate(
        self,
        username: str,
        password: str
    ) -> Optional[Dict[str, Any]]:
        """ç”¨æˆ·è®¤è¯
        
        Args:
            username: ç”¨æˆ·åæˆ–é‚®ç®±
            password: æ˜æ–‡å¯†ç 
        
        Returns:
            è®¤è¯æˆåŠŸè¿”å›åŒ…å«tokençš„å­—å…¸ï¼Œå¤±è´¥è¿”å›None
        
        Raises:
            DatabaseError: æ•°æ®åº“æŸ¥è¯¢å¤±è´¥æ—¶æŠ›å‡º
        """
        try:
            user = self._find_user(username)
            if not user or not self.auth_service.verify_password(password, user.password_hash):
                return None
            
            return self._generate_auth_response(user)
            
        except Exception as e:
            logger.error(f"Authentication failed: {e}")
            raise
```

### 2.2 é¡¹ç›®ç»“æ„

```
backend/
  app/
    __init__.py
    main.py                  # FastAPIåº”ç”¨å…¥å£
    config/
      __init__.py
      config.py              # é…ç½®ç®¡ç†
    core/                    # æ ¸å¿ƒä¸šåŠ¡é€»è¾‘
      __init__.py
      orchestrator.py
      personality/
      user/
    engines/                 # å¼•æ“å±‚
      __init__.py
      ai/
      memory/
      tools/
      voice/
    models/                  # æ•°æ®åº“æ¨¡å‹
      __init__.py
      base.py
      user.py
      session.py
    schemas/                 # Pydanticæ¨¡å‹
      __init__.py
      user.py
      chat.py
    api/                     # APIè·¯ç”±
      __init__.py
      v1/
        __init__.py
        chat.py
        user.py
        personality.py
    utils/                   # å·¥å…·å‡½æ•°
      __init__.py
      logger.py
      cache.py
  tests/                     # æµ‹è¯•
  alembic/                   # æ•°æ®åº“è¿ç§»
  logs/                      # æ—¥å¿—æ–‡ä»¶
  data/                      # æ•°æ®æ–‡ä»¶
```

### 2.3 å‘½åè§„èŒƒ

#### 2.3.1 å‘½åé£æ ¼

| ç±»å‹ | è§„èŒƒ | ç¤ºä¾‹ |
|------|------|------|
| æ¨¡å—/åŒ… | å°å†™+ä¸‹åˆ’çº¿ | `user_manager.py` |
| ç±»å | å¤§é©¼å³° | `UserManager`, `ChatEngine` |
| å‡½æ•°/æ–¹æ³• | å°å†™+ä¸‹åˆ’çº¿ | `get_user()`, `create_session()` |
| å¸¸é‡ | å¤§å†™+ä¸‹åˆ’çº¿ | `MAX_RETRY`, `DEFAULT_TIMEOUT` |
| å˜é‡ | å°å†™+ä¸‹åˆ’çº¿ | `user_id`, `session_data` |
| ç§æœ‰æ–¹æ³• | ä¸‹åˆ’çº¿å¼€å¤´ | `_validate_token()` |
| ç±»å‹å˜é‡ | å¤§é©¼å³° | `T`, `UserType` |

#### 2.3.2 å‘½åç¤ºä¾‹

```python
# å¸¸é‡
MAX_HISTORY_MESSAGES = 100
DEFAULT_TEMPERATURE = 0.7

# ç±»
class ChatEngine:
    pass

class UserManager:
    pass

# å‡½æ•°
def get_user_by_id(user_id: str) -> Optional[User]:
    pass

async def create_chat_completion(messages: List[Dict]) -> Dict:
    pass

# ç§æœ‰æ–¹æ³•
def _validate_api_key(api_key: str) -> bool:
    pass

# å˜é‡
user_id: str = "123"
session_data: Dict[str, Any] = {}
is_authenticated: bool = False
```

### 2.4 ç±»å‹æ³¨è§£

**å¿…é¡»ä½¿ç”¨ç±»å‹æ³¨è§£**ï¼Œæé«˜ä»£ç å¯è¯»æ€§å’ŒIDEæ”¯æŒã€‚

```python
from typing import Dict, List, Optional, Union, Any, Tuple
from typing import Protocol, TypedDict, Literal

# åŸºæœ¬ç±»å‹
def greet(name: str) -> str:
    return f"Hello, {name}"

# å¤æ‚ç±»å‹
def process_messages(
    messages: List[Dict[str, str]],
    options: Optional[Dict[str, Any]] = None
) -> Tuple[str, int]:
    pass

# TypedDictï¼ˆç»“æ„åŒ–å­—å…¸ï¼‰
class UserDict(TypedDict):
    id: str
    username: str
    email: str
    role: Literal["admin", "user"]

def create_user(data: UserDict) -> User:
    pass

# Protocolï¼ˆæ¥å£ï¼‰
class Engine(Protocol):
    async def generate(self, prompt: str) -> str:
        ...

# æ³›å‹
from typing import TypeVar, Generic

T = TypeVar('T')

class Cache(Generic[T]):
    def get(self, key: str) -> Optional[T]:
        pass
```

### 2.5 é”™è¯¯å¤„ç†

#### 2.5.1 è‡ªå®šä¹‰å¼‚å¸¸

```python
# app/utils/exceptions.py

class CozyError(Exception):
    """åŸºç¡€å¼‚å¸¸ç±»"""
    def __init__(self, message: str, code: str = "ERROR"):
        self.message = message
        self.code = code
        super().__init__(message)

class AuthenticationError(CozyError):
    """è®¤è¯é”™è¯¯"""
    def __init__(self, message: str = "Authentication failed"):
        super().__init__(message, code="AUTH_ERROR")

class PersonalityNotFoundError(CozyError):
    """äººæ ¼æœªæ‰¾åˆ°"""
    def __init__(self, personality_id: str):
        super().__init__(
            f"Personality not found: {personality_id}",
            code="PERSONALITY_NOT_FOUND"
        )

class ToolExecutionError(CozyError):
    """å·¥å…·æ‰§è¡Œé”™è¯¯"""
    pass
```

#### 2.5.2 å¼‚å¸¸å¤„ç†æ¨¡å¼

```python
# 1. å…·ä½“å¼‚å¸¸ä¼˜å…ˆ
try:
    user = get_user(user_id)
except UserNotFoundError:
    logger.warning(f"User not found: {user_id}")
    raise HTTPException(status_code=404, detail="User not found")
except DatabaseError as e:
    logger.error(f"Database error: {e}")
    raise HTTPException(status_code=500, detail="Database error")

# 2. ä½¿ç”¨ä¸Šä¸‹æ–‡ç®¡ç†å™¨
from contextlib import asynccontextmanager

@asynccontextmanager
async def get_db_session():
    session = SessionLocal()
    try:
        yield session
        await session.commit()
    except Exception:
        await session.rollback()
        raise
    finally:
        await session.close()

# 3. å¼‚å¸¸é“¾
try:
    result = await some_operation()
except SomeError as e:
    raise OurError("Operation failed") from e

# 4. FastAPIå¼‚å¸¸å¤„ç†
from fastapi import Request
from fastapi.responses import JSONResponse

@app.exception_handler(CozyError)
async def cozy_error_handler(request: Request, exc: CozyError):
    return JSONResponse(
        status_code=400,
        content={
            "error": exc.code,
            "message": exc.message
        }
    )
```

### 2.6 å¼‚æ­¥ç¼–ç¨‹

#### 2.6.1 å¼‚æ­¥å‡½æ•°å®šä¹‰

```python
import asyncio
from typing import AsyncIterator

# å¼‚æ­¥å‡½æ•°
async def fetch_data(url: str) -> Dict:
    async with httpx.AsyncClient() as client:
        response = await client.get(url)
        return response.json()

# å¼‚æ­¥ç”Ÿæˆå™¨
async def stream_response() -> AsyncIterator[str]:
    for i in range(10):
        await asyncio.sleep(0.1)
        yield f"chunk_{i}"

# å¼‚æ­¥ä¸Šä¸‹æ–‡ç®¡ç†å™¨
class AsyncResource:
    async def __aenter__(self):
        await self.connect()
        return self
    
    async def __aexit__(self, exc_type, exc_val, exc_tb):
        await self.close()
```

#### 2.6.2 å¹¶å‘æ§åˆ¶

```python
# å¹¶å‘æ‰§è¡Œå¤šä¸ªä»»åŠ¡
results = await asyncio.gather(
    fetch_user(user_id),
    fetch_sessions(user_id),
    fetch_preferences(user_id)
)

# å¸¦è¶…æ—¶çš„å¼‚æ­¥è°ƒç”¨
try:
    result = await asyncio.wait_for(
        slow_operation(),
        timeout=5.0
    )
except asyncio.TimeoutError:
    logger.warning("Operation timed out")

# ä¿¡å·é‡æ§åˆ¶å¹¶å‘æ•°
semaphore = asyncio.Semaphore(10)

async def limited_task(item):
    async with semaphore:
        return await process(item)

# ä»»åŠ¡å–æ¶ˆ
task = asyncio.create_task(long_running_task())
# ... ç¨å
task.cancel()
try:
    await task
except asyncio.CancelledError:
    logger.info("Task cancelled")
```

### 2.7 æ—¥å¿—è§„èŒƒ

#### 2.7.1 æ—¥å¿—é…ç½®

```python
# app/utils/logger.py
import logging
import sys
from pathlib import Path
from logging.handlers import RotatingFileHandler

def setup_logger(
    name: str = "cozychat",
    log_file: str = "logs/app.log",
    level: str = "INFO"
) -> logging.Logger:
    """é…ç½®æ—¥å¿—å™¨"""
    
    logger = logging.getLogger(name)
    logger.setLevel(getattr(logging, level.upper()))
    
    # åˆ›å»ºæ—¥å¿—ç›®å½•
    Path(log_file).parent.mkdir(parents=True, exist_ok=True)
    
    # æ–‡ä»¶å¤„ç†å™¨ï¼ˆè½®è½¬ï¼‰
    file_handler = RotatingFileHandler(
        log_file,
        maxBytes=10 * 1024 * 1024,  # 10MB
        backupCount=5,
        encoding='utf-8'
    )
    file_handler.setLevel(logging.DEBUG)
    
    # æ§åˆ¶å°å¤„ç†å™¨
    console_handler = logging.StreamHandler(sys.stdout)
    console_handler.setLevel(logging.INFO)
    
    # æ ¼å¼åŒ–
    formatter = logging.Formatter(
        '%(asctime)s - %(name)s - %(levelname)s - %(filename)s:%(lineno)d - %(message)s',
        datefmt='%Y-%m-%d %H:%M:%S'
    )
    
    file_handler.setFormatter(formatter)
    console_handler.setFormatter(formatter)
    
    logger.addHandler(file_handler)
    logger.addHandler(console_handler)
    
    return logger

logger = setup_logger()
```

#### 2.7.2 æ—¥å¿—ä½¿ç”¨

```python
from app.utils.logger import logger

# ä¸åŒçº§åˆ«
logger.debug("Detailed debug information")
logger.info("General information")
logger.warning("Warning message")
logger.error("Error occurred", exc_info=True)  # åŒ…å«å †æ ˆä¿¡æ¯
logger.critical("Critical error")

# ç»“æ„åŒ–æ—¥å¿—
logger.info(
    "User login",
    extra={
        "user_id": user_id,
        "ip": request.client.host,
        "user_agent": request.headers.get("user-agent")
    }
)

# æ€§èƒ½æ—¥å¿—
import time
start = time.time()
result = await expensive_operation()
logger.info(f"Operation completed in {time.time() - start:.2f}s")
```

### 2.8 ä¾èµ–ç®¡ç†

#### 2.8.1 requirements.txtåˆ†å±‚

```
backend/
  requirements/
    base.txt           # åŸºç¡€ä¾èµ–
    dev.txt            # å¼€å‘ä¾èµ–
    prod.txt           # ç”Ÿäº§ä¾èµ–
    test.txt           # æµ‹è¯•ä¾èµ–
```

**base.txt**:
```
fastapi==0.109.0
uvicorn[standard]==0.27.0
sqlalchemy==2.0.25
alembic==1.13.1
pydantic==2.5.3
pydantic-settings==2.1.0
openai==1.10.0
httpx==0.26.0
python-jose[cryptography]==3.3.0
passlib[bcrypt]==1.7.4
python-multipart==0.0.6
redis==5.0.1
```

**dev.txt**:
```
-r base.txt
black==23.12.1
isort==5.13.2
flake8==7.0.0
mypy==1.8.0
pre-commit==3.6.0
```

**test.txt**:
```
-r base.txt
pytest==7.4.4
pytest-asyncio==0.23.3
pytest-cov==4.1.0
pytest-mock==3.12.0
httpx==0.26.0
```

#### 2.8.2 å®‰è£…ä¾èµ–

```bash
# å¼€å‘ç¯å¢ƒ
pip install -r requirements/dev.txt

# ç”Ÿäº§ç¯å¢ƒ
pip install -r requirements/prod.txt

# æµ‹è¯•ç¯å¢ƒ
pip install -r requirements/test.txt
```

---

## 3. Reactå¼€å‘è§„èŒƒ

### 3.1 ä»£ç é£æ ¼

#### 3.1.1 ESLinté…ç½®

**`.eslintrc.json`**:

```json
{
  "extends": [
    "react-app",
    "react-app/jest",
    "plugin:@typescript-eslint/recommended",
    "prettier"
  ],
  "plugins": ["@typescript-eslint", "react-hooks"],
  "rules": {
    "react-hooks/rules-of-hooks": "error",
    "react-hooks/exhaustive-deps": "warn",
    "@typescript-eslint/explicit-module-boundary-types": "off",
    "@typescript-eslint/no-explicit-any": "warn",
    "no-console": ["warn", { "allow": ["warn", "error"] }],
    "prefer-const": "error"
  }
}
```

#### 3.1.2 Prettieré…ç½®

**`.prettierrc`**:

```json
{
  "semi": true,
  "trailingComma": "es5",
  "singleQuote": true,
  "printWidth": 100,
  "tabWidth": 2,
  "arrowParens": "always"
}
```

### 3.2 é¡¹ç›®ç»“æ„

```
frontend/
  src/
    components/          # é€šç”¨ç»„ä»¶
      ui/                # UIåŸºç¡€ç»„ä»¶
        Button/
          Button.tsx
          Button.module.css
          Button.test.tsx
          index.ts
      layout/            # å¸ƒå±€ç»„ä»¶
      chat/              # èŠå¤©ç›¸å…³ç»„ä»¶
    features/            # åŠŸèƒ½æ¨¡å—
      auth/
        components/
        hooks/
        api/
        types/
      chat/
      settings/
    hooks/               # å…¨å±€Hooks
      useAuth.ts
      useChat.ts
    services/            # APIæœåŠ¡
      api.ts
      chat.ts
      user.ts
    store/               # çŠ¶æ€ç®¡ç†
      slices/
      store.ts
    types/               # TypeScriptç±»å‹
      user.ts
      chat.ts
    utils/               # å·¥å…·å‡½æ•°
      format.ts
      storage.ts
    styles/              # å…¨å±€æ ·å¼
      globals.css
      variables.css
    App.tsx
    index.tsx
  public/
```

### 3.3 ç»„ä»¶è§„èŒƒ

#### 3.3.1 å‡½æ•°ç»„ä»¶

```typescript
// src/components/chat/ChatMessage/ChatMessage.tsx
import React from 'react';
import { format } from 'date-fns';
import styles from './ChatMessage.module.css';

/**
 * èŠå¤©æ¶ˆæ¯ç»„ä»¶å±æ€§
 */
interface ChatMessageProps {
  /** æ¶ˆæ¯è§’è‰² */
  role: 'user' | 'assistant';
  /** æ¶ˆæ¯å†…å®¹ */
  content: string;
  /** æ—¶é—´æˆ³ */
  timestamp: Date;
  /** æ˜¯å¦æ­£åœ¨åŠ è½½ */
  loading?: boolean;
  /** ç‚¹å‡»å›è°ƒ */
  onClick?: () => void;
}

/**
 * èŠå¤©æ¶ˆæ¯ç»„ä»¶
 * 
 * æ˜¾ç¤ºå•æ¡èŠå¤©æ¶ˆæ¯ï¼Œæ”¯æŒç”¨æˆ·å’ŒAIä¸¤ç§è§’è‰²ã€‚
 */
const ChatMessage: React.FC<ChatMessageProps> = ({
  role,
  content,
  timestamp,
  loading = false,
  onClick,
}) => {
  const formattedTime = format(timestamp, 'HH:mm');
  
  return (
    <div
      className={`${styles.message} ${styles[role]}`}
      data-testid={`${role}-message`}
      onClick={onClick}
    >
      <div className={styles.avatar}>
        {role === 'user' ? 'ğŸ‘¤' : 'ğŸ¤–'}
      </div>
      <div className={styles.content}>
        <div className={styles.text}>
          {loading ? <LoadingDots /> : content}
        </div>
        <div className={styles.timestamp}>{formattedTime}</div>
      </div>
    </div>
  );
};

export default ChatMessage;
```

#### 3.3.2 ç»„ä»¶æœ€ä½³å®è·µ

1. **ä½¿ç”¨å‡½æ•°ç»„ä»¶å’ŒHooks**ï¼Œé¿å…ç±»ç»„ä»¶
2. **Propsä½¿ç”¨TypeScriptæ¥å£å®šä¹‰**
3. **å¯¼å‡ºç»„ä»¶å’Œç±»å‹**:

```typescript
export type { ChatMessageProps };
export default ChatMessage;
```

4. **ä½¿ç”¨React.memoä¼˜åŒ–æ€§èƒ½**:

```typescript
export default React.memo(ChatMessage);
```

5. **æ¡ä»¶æ¸²æŸ“**:

```typescript
// å¥½çš„å†™æ³•
{isLoading && <Spinner />}
{error ? <ErrorMessage error={error} /> : <Content />}

// é¿å…
{isLoading ? <Spinner /> : null}
```

### 3.4 çŠ¶æ€ç®¡ç†

#### 3.4.1 Redux Toolkit

**Storeé…ç½®**:

```typescript
// src/store/store.ts
import { configureStore } from '@reduxjs/toolkit';
import authReducer from './slices/authSlice';
import chatReducer from './slices/chatSlice';

export const store = configureStore({
  reducer: {
    auth: authReducer,
    chat: chatReducer,
  },
});

export type RootState = ReturnType<typeof store.getState>;
export type AppDispatch = typeof store.dispatch;
```

**Sliceå®šä¹‰**:

```typescript
// src/store/slices/chatSlice.ts
import { createSlice, createAsyncThunk, PayloadAction } from '@reduxjs/toolkit';
import { chatApi } from '@/services/chat';
import type { Message, ChatState } from '@/types/chat';

const initialState: ChatState = {
  messages: [],
  loading: false,
  error: null,
};

// å¼‚æ­¥Thunk
export const sendMessage = createAsyncThunk(
  'chat/sendMessage',
  async (content: string, { rejectWithValue }) => {
    try {
      const response = await chatApi.send(content);
      return response.data;
    } catch (error) {
      return rejectWithValue(error.message);
    }
  }
);

const chatSlice = createSlice({
  name: 'chat',
  initialState,
  reducers: {
    addMessage: (state, action: PayloadAction<Message>) => {
      state.messages.push(action.payload);
    },
    clearMessages: (state) => {
      state.messages = [];
    },
  },
  extraReducers: (builder) => {
    builder
      .addCase(sendMessage.pending, (state) => {
        state.loading = true;
      })
      .addCase(sendMessage.fulfilled, (state, action) => {
        state.loading = false;
        state.messages.push(action.payload);
      })
      .addCase(sendMessage.rejected, (state, action) => {
        state.loading = false;
        state.error = action.payload as string;
      });
  },
});

export const { addMessage, clearMessages } = chatSlice.actions;
export default chatSlice.reducer;
```

**Hooks**:

```typescript
// src/store/hooks.ts
import { TypedUseSelectorHook, useDispatch, useSelector } from 'react-redux';
import type { RootState, AppDispatch } from './store';

export const useAppDispatch = () => useDispatch<AppDispatch>();
export const useAppSelector: TypedUseSelectorHook<RootState> = useSelector;
```

### 3.5 APIè°ƒç”¨

#### 3.5.1 Axioså°è£…

```typescript
// src/services/api.ts
import axios, { AxiosInstance, AxiosRequestConfig, AxiosResponse } from 'axios';

const API_BASE_URL = process.env.REACT_APP_API_BASE_URL || 'http://localhost:8000';

class ApiClient {
  private client: AxiosInstance;

  constructor() {
    this.client = axios.create({
      baseURL: API_BASE_URL,
      timeout: 30000,
      headers: {
        'Content-Type': 'application/json',
      },
    });

    this.setupInterceptors();
  }

  private setupInterceptors() {
    // è¯·æ±‚æ‹¦æˆªå™¨
    this.client.interceptors.request.use(
      (config) => {
        const token = localStorage.getItem('access_token');
        if (token) {
          config.headers.Authorization = `Bearer ${token}`;
        }
        return config;
      },
      (error) => Promise.reject(error)
    );

    // å“åº”æ‹¦æˆªå™¨
    this.client.interceptors.response.use(
      (response) => response,
      (error) => {
        if (error.response?.status === 401) {
          // å¤„ç†è®¤è¯å¤±è´¥
          localStorage.removeItem('access_token');
          window.location.href = '/login';
        }
        return Promise.reject(error);
      }
    );
  }

  async get<T>(url: string, config?: AxiosRequestConfig): Promise<T> {
    const response = await this.client.get<T>(url, config);
    return response.data;
  }

  async post<T>(url: string, data?: any, config?: AxiosRequestConfig): Promise<T> {
    const response = await this.client.post<T>(url, data, config);
    return response.data;
  }

  async put<T>(url: string, data?: any, config?: AxiosRequestConfig): Promise<T> {
    const response = await this.client.put<T>(url, data, config);
    return response.data;
  }

  async delete<T>(url: string, config?: AxiosRequestConfig): Promise<T> {
    const response = await this.client.delete<T>(url, config);
    return response.data;
  }
}

export const apiClient = new ApiClient();
```

#### 3.5.2 APIæœåŠ¡

```typescript
// src/services/chat.ts
import { apiClient } from './api';
import type { Message, ChatRequest, ChatResponse } from '@/types/chat';

export const chatApi = {
  /**
   * å‘é€èŠå¤©æ¶ˆæ¯
   */
  async send(request: ChatRequest): Promise<ChatResponse> {
    return apiClient.post<ChatResponse>('/v1/chat/completions', request);
  },

  /**
   * è·å–å†å²æ¶ˆæ¯
   */
  async getHistory(sessionId: string): Promise<Message[]> {
    return apiClient.get<Message[]>(`/v1/chat/history/${sessionId}`);
  },

  /**
   * æµå¼èŠå¤©ï¼ˆSSEï¼‰
   */
  async *streamChat(request: ChatRequest): AsyncGenerator<string> {
    const response = await fetch(`${process.env.REACT_APP_API_BASE_URL}/v1/chat/stream`, {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
        Authorization: `Bearer ${localStorage.getItem('access_token')}`,
      },
      body: JSON.stringify(request),
    });

    const reader = response.body?.getReader();
    const decoder = new TextDecoder();

    while (true) {
      const { done, value } = await reader!.read();
      if (done) break;

      const chunk = decoder.decode(value);
      const lines = chunk.split('\n');

      for (const line of lines) {
        if (line.startsWith('data: ')) {
          const data = line.slice(6);
          if (data === '[DONE]') return;
          yield data;
        }
      }
    }
  },
};
```

### 3.6 æ ·å¼è§„èŒƒ

#### 3.6.1 CSS Modules

```css
/* ChatMessage.module.css */
.message {
  display: flex;
  gap: 12px;
  padding: 16px;
  margin-bottom: 12px;
  border-radius: 8px;
  transition: background-color 0.2s;
}

.message:hover {
  background-color: var(--hover-bg);
}

.user {
  flex-direction: row-reverse;
  background-color: var(--user-message-bg);
}

.assistant {
  background-color: var(--assistant-message-bg);
}

.avatar {
  width: 40px;
  height: 40px;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 20px;
}

.content {
  flex: 1;
  min-width: 0; /* é˜²æ­¢æ–‡æœ¬æº¢å‡º */
}

.text {
  word-wrap: break-word;
  white-space: pre-wrap;
}

.timestamp {
  font-size: 12px;
  color: var(--text-secondary);
  margin-top: 4px;
}
```

#### 3.6.2 CSSå˜é‡

```css
/* src/styles/variables.css */
:root {
  /* Colors */
  --primary-color: #3b82f6;
  --secondary-color: #64748b;
  --success-color: #10b981;
  --error-color: #ef4444;
  
  /* Backgrounds */
  --bg-primary: #ffffff;
  --bg-secondary: #f8fafc;
  --hover-bg: #f1f5f9;
  
  /* Text */
  --text-primary: #0f172a;
  --text-secondary: #64748b;
  
  /* Spacing */
  --spacing-xs: 4px;
  --spacing-sm: 8px;
  --spacing-md: 16px;
  --spacing-lg: 24px;
  --spacing-xl: 32px;
  
  /* Border */
  --border-radius: 8px;
  --border-color: #e2e8f0;
}

/* Dark mode */
@media (prefers-color-scheme: dark) {
  :root {
    --bg-primary: #0f172a;
    --bg-secondary: #1e293b;
    --hover-bg: #334155;
    --text-primary: #f1f5f9;
    --text-secondary: #94a3b8;
    --border-color: #334155;
  }
}
```

### 3.7 æ€§èƒ½ä¼˜åŒ–

#### 3.7.1 ä»£ç åˆ†å‰²

```typescript
// è·¯ç”±æ‡’åŠ è½½
import { lazy, Suspense } from 'react';
import { BrowserRouter, Routes, Route } from 'react-router-dom';

const Chat = lazy(() => import('./features/chat/Chat'));
const Settings = lazy(() => import('./features/settings/Settings'));

function App() {
  return (
    <BrowserRouter>
      <Suspense fallback={<Loading />}>
        <Routes>
          <Route path="/chat" element={<Chat />} />
          <Route path="/settings" element={<Settings />} />
        </Routes>
      </Suspense>
    </BrowserRouter>
  );
}
```

#### 3.7.2 useMemoå’ŒuseCallback

```typescript
import { useMemo, useCallback } from 'react';

function ChatList({ messages, onMessageClick }) {
  // ç¼“å­˜è®¡ç®—ç»“æœ
  const sortedMessages = useMemo(() => {
    return messages.sort((a, b) => a.timestamp - b.timestamp);
  }, [messages]);

  // ç¼“å­˜å›è°ƒå‡½æ•°
  const handleClick = useCallback(
    (id: string) => {
      onMessageClick(id);
    },
    [onMessageClick]
  );

  return (
    <div>
      {sortedMessages.map((msg) => (
        <ChatMessage key={msg.id} {...msg} onClick={() => handleClick(msg.id)} />
      ))}
    </div>
  );
}
```

#### 3.7.3 è™šæ‹Ÿæ»šåŠ¨

```typescript
import { FixedSizeList } from 'react-window';

function MessageList({ messages }) {
  const Row = ({ index, style }) => (
    <div style={style}>
      <ChatMessage {...messages[index]} />
    </div>
  );

  return (
    <FixedSizeList
      height={600}
      itemCount={messages.length}
      itemSize={100}
      width="100%"
    >
      {Row}
    </FixedSizeList>
  );
}
```

---

## 4. Gitå·¥ä½œæµ

### 4.1 åˆ†æ”¯ç®¡ç†

```
main          # ç”Ÿäº§åˆ†æ”¯ï¼Œåªæ¥å—merge
  â””â”€ develop  # å¼€å‘åˆ†æ”¯
      â”œâ”€ feature/chat-ui          # åŠŸèƒ½åˆ†æ”¯
      â”œâ”€ feature/voice-support
      â”œâ”€ bugfix/memory-leak       # Bugä¿®å¤
      â””â”€ hotfix/critical-bug      # ç´§æ€¥ä¿®å¤
```

### 4.2 æäº¤è§„èŒƒ

ä½¿ç”¨ **Conventional Commits**:

```
<type>(<scope>): <subject>

<body>

<footer>
```

**ç±»å‹**:
- `feat`: æ–°åŠŸèƒ½
- `fix`: Bugä¿®å¤
- `docs`: æ–‡æ¡£æ›´æ–°
- `style`: ä»£ç æ ¼å¼
- `refactor`: é‡æ„
- `test`: æµ‹è¯•
- `chore`: æ„å»º/å·¥å…·

**ç¤ºä¾‹**:

```bash
feat(chat): add streaming response support

- Implement SSE for chat streaming
- Add loading indicator
- Update API client

Closes #123
```

### 4.3 PRæµç¨‹

1. åˆ›å»ºåŠŸèƒ½åˆ†æ”¯
2. å¼€å‘å¹¶æäº¤
3. æ¨é€åˆ°è¿œç¨‹
4. åˆ›å»ºPull Request
5. Code Review
6. é€šè¿‡CI/CD
7. Mergeåˆ°develop

---

## 5. æ€»ç»“

æœ¬æ–‡æ¡£å®šä¹‰äº†CozyChaté¡¹ç›®çš„å®Œæ•´å¼€å‘è§„èŒƒï¼ŒåŒ…æ‹¬ï¼š

âœ… **é¡¹ç›®è§„èŒƒ**: ç¯å¢ƒå˜é‡ã€æ•°æ®åº“è¿ç§»ã€ä»£ç è´¨é‡ã€æµ‹è¯•ã€æ–‡æ¡£  
âœ… **Pythonè§„èŒƒ**: ä»£ç é£æ ¼ã€å‘½åã€ç±»å‹æ³¨è§£ã€å¼‚æ­¥ã€æ—¥å¿—  
âœ… **Reactè§„èŒƒ**: ç»„ä»¶ã€çŠ¶æ€ç®¡ç†ã€APIã€æ ·å¼ã€æ€§èƒ½

**å¼ºåˆ¶æ‰§è¡Œ**:
- Pre-commit hooksè‡ªåŠ¨æ£€æŸ¥
- CI/CDæµç¨‹éªŒè¯
- Code Reviewå¿…é¡»é€šè¿‡

---

**æ–‡æ¡£ç‰ˆæœ¬**: v1.0  
**æœ€åæ›´æ–°**: 2025-11-06  
**ç»´æŠ¤è€…**: CozyChat Team

